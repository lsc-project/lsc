<?xml version="1.0" ?>
<lsc xmlns="http://lsc-project.org/XSD/lsc-core-2.1.xsd"
	revision="0">
	<connections>
		<ldapConnection>
			<name>src-ldap</name>
			<url>ldap://localhost:33389/dc=lsc-project,dc=org</url>
			<username>cn=Directory Manager</username>
			<password>secret</password>
			<authentication>SIMPLE</authentication>
			<referral>IGNORE</referral>
			<derefAliases>NEVER</derefAliases>
			<version>VERSION_3</version>
			<pageSize>-1</pageSize>
			<factory>com.sun.jndi.ldap.LdapCtxFactory</factory>
			<tlsActivated>false</tlsActivated>
			<saslMutualAuthentication>false</saslMutualAuthentication>
		</ldapConnection>
		<databaseConnection>
			<name>dst-jdbc</name>
			<url>jdbc:hsqldb:hsql://localhost/lscdb</url>
			<username>sa</username>
			<password></password>
			<driver>org.hsqldb.jdbcDriver</driver>
		</databaseConnection>
	</connections>
	<tasks>
		<task>
			<name>LDAP2JDBCTask</name>
			<bean>org.lsc.beans.SimpleBean</bean>
			<ldapSourceService>
				<name>MySyncTask-src</name>
				<connection reference="src-ldap" />
				<baseDn>ou=Sample,dc=lsc-project,dc=org</baseDn>
				<pivotAttributes>
					<string>externalId</string>
				</pivotAttributes>
				<fetchedAttributes>
					<string>externalId</string>
					<string>accessSA</string>
					<string>description</string>
					<string>cn</string>
					<string>sn</string>
					<string>givenName</string>
					<string>userPassword</string>
					<string>objectClass</string>
					<string>mail</string>
					<string>carLicense</string>
					<string>uid</string>
					<string>registeredAddress</string>
					<string>o</string>
					<string>telephonenumber</string>
				</fetchedAttributes>
				<getAllFilter>(&amp;(objectClass=inetOrgPerson)(externalId=*)(accessSA=TRUE)(mail=*))</getAllFilter>
				<getOneFilter>(&amp;(objectClass=inetOrgPerson)(externalId={externalId})(accessSA=TRUE)(mail=*))</getOneFilter>
				<cleanFilter>(&amp;(objectClass=inetOrgPerson)(externalId={externalId})(accessSA=TRUE)(mail=*))</cleanFilter>
			</ldapSourceService>
			<databaseDestinationService>
				<name>MySyncTask-dst</name>
				<connection reference="dst-jdbc" />
				<requestNameForList>getInetOrgPersonList</requestNameForList>
				<requestNameForObject>getInetOrgPerson</requestNameForObject>
				<requestsNameForInsert>
					<string>insertInetOrgPerson</string>
				</requestsNameForInsert>
				<requestsNameForUpdate>
					<string>updateInetOrgPerson</string>
				</requestsNameForUpdate>
				<requestsNameForDelete>
					<string>deleteInetOrgPerson</string>
				</requestsNameForDelete>
			</databaseDestinationService>
			<propertiesBasedSyncOptions>
				<mainIdentifier>srcBean.getMainIdentifier()</mainIdentifier>
				<defaultDelimiter>|</defaultDelimiter>
				<defaultPolicy>FORCE</defaultPolicy>
				<dataset>
					<name>carLicense</name>
					<policy>FORCE</policy>
					<forceValues>
						<string>
							<![CDATA[rjs:
							var carl = srcBean.getDatasetValuesById("carLicense");
							var result = new java.util.ArrayList();
							for (var i=0;i<carl.size(); i++) {
								result.add(carl[i]);
							}
							result.toString();
						]]>
						</string>
					</forceValues>
				</dataset>
				<dataset>
					<name>accesssa</name>
					<policy>FORCE</policy>
					<forceValues>
						<string><![CDATA[js:
						//var val = srcBean.getDatasetFirstValueById("accesssa")
						//var val2 = val.toLowerCase();
						//new java.lang.Boolean(srcBean.getDatasetFirstValueById("accesssa"));
						srcBean.getDatasetFirstValueById("accesssa").toString().toLowerCase();
						]]></string>
					</forceValues>
				</dataset>
			</propertiesBasedSyncOptions>
		</task>
		<task>
			<name>SetExtIdTask</name>
			<bean>org.lsc.beans.SimpleBean</bean>
			<ldapSourceService>
				<name>SetExtId-src</name>
				<connection reference="src-ldap" />
				<baseDn>ou=Sample,dc=lsc-project,dc=org</baseDn>
				<pivotAttributes>
					<string>mail</string>
				</pivotAttributes>
				<fetchedAttributes>
					<string>objectClass</string>
					<string>mail</string>
					<string>accessSA</string>
				</fetchedAttributes>
				<getAllFilter>(&amp;(objectClass=inetOrgPerson)(!(externalId=*)))</getAllFilter>
				<getOneFilter>(&amp;(objectClass=inetOrgPerson)(mail={mail})(!(externalId=*)))</getOneFilter>
			</ldapSourceService>
			<ldapDestinationService>
				<name>SetExtId-dst</name>
				<connection reference="src-ldap" />
				<baseDn>ou=Sample,dc=lsc-project,dc=org</baseDn>
				<pivotAttributes>
					<string>mail</string>
				</pivotAttributes>
				<fetchedAttributes>
					<string>objectClass</string>
					<string>mail</string>
					<string>externalId</string>
					<string>accessSA</string>
				</fetchedAttributes>
				<getAllFilter>(&amp;(objectClass=inetOrgPerson)(!(externalId=*)))</getAllFilter>
				<getOneFilter>(&amp;(objectClass=inetOrgPerson)(mail={mail})(!(externalId=*)))</getOneFilter>
			</ldapDestinationService>
			<propertiesBasedSyncOptions>
				<mainIdentifier>srcBean.getMainIdentifier()</mainIdentifier>
				<defaultDelimiter>|</defaultDelimiter>
				<defaultPolicy>FORCE</defaultPolicy>
				<conditions>
					<create>false</create>
					<update>true</update>
					<delete>false</delete>
					<changeId>false</changeId>
				</conditions>
				<dataset>
					<name>objectClass</name>
					<policy>FORCE</policy>
					<forceValues>
						<string>"inetOrgPersonExtended"</string>
						<string>"inetOrgPerson"</string>
						<string>"organizationalPerson"</string>
						<string>"person"</string>
						<string>"top"</string>
					</forceValues>
					<delimiter>,</delimiter>
				</dataset>
				<dataset>
					<name>externalId</name>
					<policy>KEEP</policy>
					<defaultValues>
						<string>
						<![CDATA[rjs:
						java.util.UUID.randomUUID().toString();
						]]>
						</string>
					</defaultValues>
				</dataset>
				<dataset>
					<name>AccessSA</name>
					<policy>FORCE</policy>
					<defaultValues>
						<string>"TRUE"</string>
					</defaultValues>
				</dataset>
			</propertiesBasedSyncOptions>
		</task>
	</tasks>
</lsc>
