<?xml version="1.0" ?>
<lsc xmlns="http://lsc-project.org/XSD/lsc-core-2.1.xsd" xmlns:james="http://lsc-project.org/XSD/lsc-james0-plugin-1.0.xsd" revision="0"> 
  <connections>
    <ldapConnection>
      <name>openldap</name>
      <url>ldap://ldap.example.com/dc=example.com,dc=com</url>
      <username></username>
      <password></password>
      <authentication>SIMPLE</authentication>
      <referral>THROW</referral>
      <derefAliases>NEVER</derefAliases>
      <version>VERSION_3</version>
      <pageSize>-1</pageSize>
      <factory>com.sun.jndi.ldap.LdapCtxFactory</factory>
      <tlsActivated>false</tlsActivated>
      <saslMutualAuthentication>false</saslMutualAuthentication>
    </ldapConnection>
    <pluginConnection implementationClass="org.lsc.plugins.connectors.james.generated.jamesConnectionType">
      <name>james</name>
      <url>http://localhost:8000/</url>
      <username></username>
      <password>eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJhZG1pbkBqYW1lcy5vcmciLCJhZG1pbiI6dHJ1ZSwiaWF0IjoxNTY4NjQ1MTE1fQ.Xc1nFwpi6GKHNhZvTqZGeroW-6vDr5unsuRrv_PZ4yPKKvWI3ZJa3T5bwMqO91rMTgLjfxidX6wWx7XYz-V_pTNrYgoBXMJ8e7sG7IPeZiASGmRypLPIJA-jkuFtfHgg5Jg1YeM7yzXS2WGzWYCZWoTBPXBW8WNJYr_YOlPJ87idGoulGF4Go5rTIm4BHqb2nVIiAhofF4orrqeNJ7a9G-iODwJJRKLnc5n1lRIxPqS8rFZ_UgDUeoQsNkz-usKQaCI_fPCHeH1sSd0kEAMuuXGkBAehB11W3v5j7KftgbKxovHe7VA12oOsx19HWoGkL9-1qV9J3x0Qvdr17F3ZSymV06haDFAMoYELWQDcMoztYhvMkLzAq_0Tw0vfOWizD8TsqrD3cZ7BW2_QOG0GiTRIRfQHRbN4tEmb_i9B4B9g2ywzfqT6Iq9oBDONMEsrQb0zhgIyMRS5KXNcyMpZ8jgyKrMB-akRDt0-eUvMe4rLZ6HFnZh9utJDL_doLQCWnaWqMEFgoUyeKzQWeNTjTxzM7tvw0yB2NL5EfJI8tE-3AI2X_S2mvMCjXLHhX8t8UiRteyo8uZpBSM2crYsesrKKY-T2kzC8T_8vXpX4RXsFKe5Mkl68BYKbIEABu_HYWyaDG-LeTGrcMBv7cmS8TtxdBUj8G_N_cKiOGMwBnI0</password>
    </pluginConnection>
  </connections>
  <audits/>  
  <tasks>
    <task>
      <name>addressAlias</name>
      <bean>org.lsc.beans.SimpleBean</bean>
      <ldapSourceService>
        <name>openldap-obm</name>
        <connection reference="openldap"/>
        <baseDn>ou=users,dc=example.com,dc=com</baseDn>
        <pivotAttributes>
          <string>mail</string>
        </pivotAttributes>
        <fetchedAttributes>
          <string>mail</string>
          <string>mailAlias</string>
        </fetchedAttributes>
        <getAllFilter>(&amp;(objectClass=obmUser)(mail=*))</getAllFilter>
        <getOneFilter>(&amp;(objectClass=obmUser)(mail={mail}))</getOneFilter>
        <cleanFilter>(&amp;(objectClass=obmUser)(mail={email}))</cleanFilter>
      </ldapSourceService>
      <pluginDestinationService implementationClass="org.lsc.plugins.connectors.james.JamesAliasDstService">
        <name>james-alias-dst</name>
        <connection reference="james" />
        <james:jamesAliasService> 
          <name>james-alias-service-dst</name>
          <connection reference="james" />
          <james:writableAttributes>
            <string>sources</string>
          </james:writableAttributes>
        </james:jamesAliasService> 
      </pluginDestinationService>
      <propertiesBasedSyncOptions>
        <mainIdentifier>srcBean.getDatasetFirstValueById('mail');</mainIdentifier>
        <defaultDelimiter>;</defaultDelimiter>
        <defaultPolicy>FORCE</defaultPolicy>
        <conditions>
          <create>true</create>
          <update>true</update>
          <delete>true</delete>
          <changeId>false</changeId>
        </conditions>
        <dataset>
          <name>email</name>
          <forceValues>
            <string>srcBean.getDatasetFirstValueById("mail")</string>
          </forceValues>
        </dataset>
        <dataset>
          <name>sources</name>
          <forceValues>
            <string>srcBean.getDatasetValuesById("mailAlias")</string>
          </forceValues>
        </dataset>
      </propertiesBasedSyncOptions>
    </task>
  </tasks>
</lsc>
