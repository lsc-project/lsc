<?xml version="1.0" ?>
<lsc xmlns="http://lsc-project.org/XSD/lsc-core-2.2.xsd" revision="1">
	<connections>
		<ldapConnection id="src-ldap">
			<name>src-ldap</name>
			<url>ldap://localhost:33389/dc=lsc-project,dc=org</url>
			<username>cn=Directory Manager</username>
			<password>secret</password>
			<authentication>SIMPLE</authentication>
			<referral>IGNORE</referral>
			<derefAliases>NEVER</derefAliases>
			<version>VERSION_3</version>
			<pageSize>-1</pageSize>
			<factory>com.sun.jndi.ldap.LdapCtxFactory</factory>
			<tlsActivated>false</tlsActivated>
		</ldapConnection>
		<databaseConnection id="src-jdbc">
			<name>src-jdbc</name>
			<url>jdbc:hsqldb:file:hsqldb/lsc</url>
			<username>sa</username>
			<password/>
			<driver>org.hsqldb.jdbcDriver</driver>
		</databaseConnection>
		<ldapConnection id="dst-ldap">
			<name>dst-ldap</name>
			<url>ldap://localhost:33389/dc=lsc-project,dc=org</url>
			<username>cn=Directory Manager</username>
			<password>secret</password>
			<authentication>SIMPLE</authentication>
			<referral>IGNORE</referral>
			<derefAliases>NEVER</derefAliases>
			<version>VERSION_3</version>
			<pageSize>-1</pageSize>
			<factory>com.sun.jndi.ldap.LdapCtxFactory</factory>
			<tlsActivated>false</tlsActivated>
		</ldapConnection>
	</connections>
	<audits>
		<csvAudit>
			<name>csvAudit</name>
			<append>false</append>
			<file>$TEMP/log.csv</file>
			<datasets>cn, sn, givenName</datasets>
			<separator>;</separator>
		</csvAudit>
	</audits>
	<tasks>
		<task>
			<name>ldap2ldapTestTask</name>
			<bean>org.lsc.beans.SimpleBean</bean>
			<ldapSourceService>
				<name>ldap2ldapTestTask-src</name>
				<connection reference="src-ldap"/>
				<baseDn>ou=ldap2ldap2TestTaskSrc,ou=Test Data,dc=lsc-project,dc=org</baseDn>
				<pivotAttributes >
					<string>cn</string>
					<string>sn</string>
				</pivotAttributes>
				<fetchedAttributes>
					<string>description</string>
					<string>cn</string>
					<string>sn</string>
					<string>userPassword</string>
					<string>telephoneNumber</string>
					<string>seeAlso</string>
				</fetchedAttributes>
				<getAllFilter>(&amp;(sn=*))</getAllFilter>
				<getOneFilter>(sn={sn})</getOneFilter>
				<filterAsync>(&amp;(sn=*)(modifytimestamp&gt;={0}))</filterAsync>
				<dateFormat>yyyyMMddHHmmss'Z'</dateFormat>
				<interval>5</interval>
			</ldapSourceService>
			<ldapDestinationService>
				<name>ldap2ldapTestTask-dst</name>
				<connection reference="dst-ldap"/>
				<baseDn>ou=ldap2ldap2TestTaskDst,ou=Test Data,dc=lsc-project,dc=org</baseDn>
				<pivotAttributes>
					<string>cn</string>
					<string>sn</string>
				</pivotAttributes>
				<fetchedAttributes>
					<string>description</string>
					<string>cn</string>
					<string>objectClass</string>
					<string>userPassword</string>
					<string>sn</string>
					<string>telephoneNumber</string>
					<string>seeAlso</string>
					<string>mail</string>
				</fetchedAttributes>
				<getAllFilter>(sn=*)</getAllFilter>
				<getOneFilter>(sn={sn})</getOneFilter>
			</ldapDestinationService>
			<propertiesBasedSyncOptions>
				<mainIdentifier>'cn=' + srcBean.getAttributeValueById('uid')</mainIdentifier>
		        <defaultDelimiter>,</defaultDelimiter>
		        <defaultPolicy>KEEP</defaultPolicy>
		        <dataset>
		          <name>telephoneNumber</name>
		          <policy>MERGE</policy>
		          <defaultValues>
		          	<string>"123456","789987"</string>
		          </defaultValues>
		          <createValues>
		            <string>"000000","11111"</string>
		          </createValues>
		        </dataset>
		        <dataset>
		          <name>objectclass</name>
		          <policy>MERGE</policy>
		          <defaultValues>
						<string>"person","top"</string>
		          </defaultValues>
		          <createValues>
		            <string>"inetOrgPerson"</string>
		          </createValues>
		        </dataset>
		        <dataset>
		          <name>initials</name>
		          <createValues>
		            <string>"cn=oops"</string>
		          </createValues>
		        </dataset>
		        <dataset>
		          <name>seeAlso</name>
		          <policy>FORCE</policy>
		        </dataset>
		        <dataset>
		          <name>description</name>
		          <policy>MERGE</policy>
		          <defaultValues>
		          	<string>srcBean.getAttributeFirstValueById("userPassword")</string>
		          </defaultValues>
		        </dataset>
		        <dataset>
		          <name>userPassword</name>
		          <policy>FORCE</policy>
		          <forceValues>
		            <string>"secret" + srcBean.getAttributeFirstValueById("cn")</string>
		          </forceValues>
		        </dataset>
		        <dataset>
		          <name>mail</name>
		          <createValues>
		            <string>"ok@domain.net"</string>
		          </createValues>
		        </dataset>
			</propertiesBasedSyncOptions>
			<auditLog reference="csvAudit"/>
		</task>
		<task>
			<name>db2ldapTestTask</name>
			<bean>org.lsc.beans.SimpleBean</bean>
			<databaseSourceService>
				<name>db2ldapTestTask-src</name>
				<connection reference="src-jdbc"/>
				<requestNameForList>getListTestDb2Ldap</requestNameForList>
				<requestNameForObject>getObjectTestDb2Ldap</requestNameForObject>
			</databaseSourceService>
			<ldapDestinationService>
				<name>db2ldapTestTask-dst</name>
				<connection reference="dst-ldap"/>
				<baseDn>ou=db2ldap2TestTaskDst,ou=Test Data,dc=lsc-project,dc=org</baseDn>
				<pivotAttributes>
					<string>givenName</string>
					<string>sn</string>
				</pivotAttributes>
				<fetchedAttributes>
					<string>description</string>
					<string>cn</string>
					<string>objectClass</string>
					<string>userPassword</string>
					<string>sn</string>
					<string>mail</string>
				</fetchedAttributes>
				<getAllFilter>(&amp;(sn=*)(givenName=*))</getAllFilter>
				<getOneFilter>(&amp;(sn={sn})(givenName={givenName}))</getOneFilter>
			</ldapDestinationService>
			<propertiesBasedSyncOptions>
				<mainIdentifier>'cn=' + srcBean.getAttributeValueById('uid')</mainIdentifier>
		        <defaultDelimiter>,</defaultDelimiter>
		        <defaultPolicy>KEEP</defaultPolicy>
		        <dataset>
		          <name>telephoneNumber</name>
		          <policy>MERGE</policy>
		          <defaultValues>
		          	<string>"123456","789987"</string>
		          </defaultValues>
		          <createValues>
		            <string>"000000","11111"</string>
		          </createValues>
		        </dataset>
		        <dataset>
		          <name>objectclass</name>
		          <policy>FORCE</policy>
		          <defaultValues>
						<string>"person","top","organizationalPerson","inetOrgPerson"</string>
		          </defaultValues>
		        </dataset>
		        <dataset>
		          <name>description</name>
		          <policy>MERGE</policy>
		          <defaultValues>
		          	<string>srcBean.getAttributeFirstValueById("userPassword")</string>
		          </defaultValues>
		        </dataset>
		        <dataset>
		          <name>userPassword</name>
		          <policy>FORCE</policy>
		          <forceValues>
		            <string>srcBean.getAttributeFirstValueById("password")</string>
		          </forceValues>
		        </dataset>
		        <dataset>
		          <name>mail</name>
		          <policy>KEEP</policy>
		          <createValues>
		            <string>"ok@domain.net"</string>
		          </createValues>
		        </dataset>
		        <dataset>
		          <name>cn</name>
		          <policy>FORCE</policy>
		          <forceValues>
		            <string>srcBean.getAttributeFirstValueById("givenName") + " " + + srcBean.getAttributeFirstValueById("sn")</string>
		          </forceValues>
		        </dataset>
			</propertiesBasedSyncOptions>
		</task>
	</tasks>
</lsc>
